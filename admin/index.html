<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post Generator v2</title>
    <script src="https://cdn.jsdelivr.net/npm/@tailwindcss/browser@4"></script>
</head>
<body class="bg-gray-50 min-h-screen">
    <header class="bg-white border-b sticky top-0 z-40 shadow-sm">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                </svg>
                <h1 class="text-xl font-bold">Blog Post Generator v2</h1>
            </div>
            <button id="configBtn" class="p-2 hover:bg-gray-100 rounded transition">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"/>
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                </svg>
            </button>
        </div>
    </header>

    <div id="configPanel" class="hidden bg-blue-50 border-b">
        <div class="max-w-7xl mx-auto px-4 py-4">
            <h3 class="font-semibold mb-3">‚öôÔ∏è Konfigurasi GitHub</h3>
            <div class="grid md:grid-cols-3 gap-3 mb-3">
                <input type="text" id="githubUsername" placeholder="GitHub Username" class="px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-white"/>
                <input type="text" id="githubRepo" placeholder="Repository Name" class="px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-white"/>
                <input type="password" id="githubToken" placeholder="Personal Access Token" class="px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none bg-white"/>
            </div>
            <button id="saveConfigBtn" class="px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition font-medium">üíæ Simpan Konfigurasi</button>
        </div>
    </div>

    <div id="statusMsg" class="hidden"></div>

    <main class="max-w-7xl mx-auto px-4 py-6">
        <div class="bg-white rounded-lg shadow-sm p-6">
            <div class="grid md:grid-cols-2 gap-4 mb-4">
                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700">Judul *</label>
                    <input type="text" id="postTitle" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Masukkan judul artikel"/>
                </div>
                
                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700">Slug (Auto-generated)</label>
                    <input type="text" id="postSlug" class="w-full px-3 py-2 border border-gray-300 rounded bg-gray-50 focus:ring-2 focus:ring-blue-500 outline-none" placeholder="auto-dari-judul"/>
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1 text-gray-700">Meta Deskripsi *</label>
                    <textarea id="postDescription" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none" rows="2" placeholder="Deskripsi singkat untuk SEO"></textarea>
                </div>

                <div class="md:col-span-2">
                    <label class="block text-sm font-medium mb-1 text-gray-700">Featured Image URL üÜï</label>
                    <input type="url" id="postImage" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="https://example.com/image.jpg (opsional)"/>
                    <p class="text-xs text-gray-500 mt-1">üí° Upload gambar ke <a href="https://imgur.com/" target="_blank" class="text-blue-600 underline">Imgur</a> atau gunakan URL gambar lain</p>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700">Author *</label>
                    <input type="text" id="postAuthor" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none" placeholder="Nama penulis"/>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700">Tanggal Posting *</label>
                    <input type="date" id="postDate" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"/>
                </div>

                <div>
                    <label class="block text-sm font-medium mb-1 text-gray-700">Tanggal Update (Opsional)</label>
                    <input type="date" id="postUpdateDate" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none"/>
                </div>

                <div class="flex items-center">
                    <label class="flex items-center gap-2 cursor-pointer">
                        <input type="checkbox" id="showSidebar" checked class="w-4 h-4 text-blue-600 rounded focus:ring-2 focus:ring-blue-500"/>
                        <span class="text-sm font-medium text-gray-700">Tampilkan Sidebar</span>
                    </label>
                </div>
            </div>

            <div class="mb-4">
                <label class="block text-sm font-medium mb-1 text-gray-700">Konten Artikel (Markdown) *</label>
                <textarea id="postContent" class="w-full px-3 py-2 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 outline-none font-mono text-sm" rows="15" placeholder="Tulis konten artikel dalam format Markdown..."></textarea>
            </div>

            <div class="flex gap-3">
                <button id="publishBtn" class="flex items-center gap-2 px-6 py-2 bg-blue-600 text-white rounded hover:bg-blue-700 transition font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"/>
                    </svg>
                    Publikasikan
                </button>
                <button id="previewBtn" class="flex items-center gap-2 px-6 py-2 bg-gray-600 text-white rounded hover:bg-gray-700 transition font-medium">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"/>
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"/>
                    </svg>
                    Preview
                </button>
            </div>
        </div>
    </main>

    <div id="previewModal" class="hidden fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto">
            <div class="sticky top-0 bg-white border-b p-4 flex justify-between items-center">
                <h3 class="text-xl font-bold">Preview Markdown</h3>
                <button id="closePreviewBtn" class="p-2 hover:bg-gray-100 rounded transition">
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="p-6">
                <pre id="previewContent" class="bg-gray-50 p-4 rounded overflow-x-auto text-sm whitespace-pre-wrap"></pre>
            </div>
        </div>
    </div>

    <script>
        document.getElementById('postDate').value = new Date().toISOString().split('T')[0];

        const loadConfig = () => {
            document.getElementById('githubUsername').value = localStorage.getItem('github_username') || '';
            document.getElementById('githubRepo').value = localStorage.getItem('github_repo') || '';
            document.getElementById('githubToken').value = localStorage.getItem('github_token') || '';
        };
        loadConfig();

        document.getElementById('configBtn').addEventListener('click', () => {
            document.getElementById('configPanel').classList.toggle('hidden');
        });

        document.getElementById('saveConfigBtn').addEventListener('click', () => {
            localStorage.setItem('github_username', document.getElementById('githubUsername').value);
            localStorage.setItem('github_repo', document.getElementById('githubRepo').value);
            localStorage.setItem('github_token', document.getElementById('githubToken').value);
            document.getElementById('configPanel').classList.add('hidden');
            showStatus('‚úÖ Konfigurasi disimpan!', 'success');
        });

        document.getElementById('postTitle').addEventListener('input', (e) => {
            const title = e.target.value;
            const slug = title.toLowerCase().replace(/[^a-z0-9\s-]/g, '').replace(/\s+/g, '-').replace(/-+/g, '-').trim();
            document.getElementById('postSlug').value = slug;
        });

        const showStatus = (message, type = 'info') => {
            const statusMsg = document.getElementById('statusMsg');
            const colors = {
                success: 'bg-green-50 text-green-800 border-green-200',
                error: 'bg-red-50 text-red-800 border-red-200',
                info: 'bg-blue-50 text-blue-800 border-blue-200'
            };
            statusMsg.className = `${colors[type]} border-b px-4 py-3 text-center font-medium`;
            statusMsg.textContent = message;
            statusMsg.classList.remove('hidden');
            setTimeout(() => statusMsg.classList.add('hidden'), 5000);
        };

        const generateMarkdown = () => {
            const title = document.getElementById('postTitle').value;
            const description = document.getElementById('postDescription').value;
            const author = document.getElementById('postAuthor').value;
            const date = document.getElementById('postDate').value;
            const updateDate = document.getElementById('postUpdateDate').value;
            const content = document.getElementById('postContent').value;
            const showSidebar = document.getElementById('showSidebar').checked;
            const slug = document.getElementById('postSlug').value;
            const image = document.getElementById('postImage').value;

            return `---
layout: post
title: "${title}"
description: "${description}"
author: "${author}"
date: ${date}
${updateDate ? `updated: ${updateDate}` : ''}
${image ? `image: "${image}"` : ''}
sidebar: ${showSidebar}
permalink: /blog/${slug}/
---

${content}`;
        };

        document.getElementById('previewBtn').addEventListener('click', () => {
            document.getElementById('previewContent').textContent = generateMarkdown();
            document.getElementById('previewModal').classList.remove('hidden');
        });

        document.getElementById('closePreviewBtn').addEventListener('click', () => {
            document.getElementById('previewModal').classList.add('hidden');
        });

        document.getElementById('publishBtn').addEventListener('click', async () => {
            const username = localStorage.getItem('github_username');
            const repo = localStorage.getItem('github_repo');
            const token = localStorage.getItem('github_token');

            if (!username || !repo || !token) {
                showStatus('‚ùå Harap konfigurasi GitHub terlebih dahulu!', 'error');
                document.getElementById('configPanel').classList.remove('hidden');
                return;
            }

            const title = document.getElementById('postTitle').value;
            const content = document.getElementById('postContent').value;
            const slug = document.getElementById('postSlug').value;
            const date = document.getElementById('postDate').value;

            if (!title || !content) {
                showStatus('‚ùå Judul dan konten harus diisi!', 'error');
                return;
            }

            showStatus('‚è≥ Sedang mempublikasikan...', 'info');

            const fileName = `${date}-${slug}.md`;
            const filePath = `_posts/${fileName}`;
            const markdown = generateMarkdown();
            const encodedContent = btoa(unescape(encodeURIComponent(markdown)));

            try {
                const response = await fetch(`https://api.github.com/repos/${username}/${repo}/contents/${filePath}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        message: `Add blog post: ${title}`,
                        content: encodedContent,
                    })
                });

                if (response.ok) {
                    showStatus('‚úÖ Artikel berhasil dipublikasikan!', 'success');
                    setTimeout(() => {
                        const author = document.getElementById('postAuthor').value;
                        document.getElementById('postTitle').value = '';
                        document.getElementById('postSlug').value = '';
                        document.getElementById('postDescription').value = '';
                        document.getElementById('postContent').value = '';
                        document.getElementById('postUpdateDate').value = '';
                        document.getElementById('postImage').value = '';
                        document.getElementById('postDate').value = new Date().toISOString().split('T')[0];
                        document.getElementById('postAuthor').value = author;
                        document.getElementById('showSidebar').checked = true;
                    }, 2000);
                } else {
                    const error = await response.json();
                    showStatus(`‚ùå Error: ${error.message}`, 'error');
                }
            } catch (error) {
                showStatus(`‚ùå Error: ${error.message}`, 'error');
            }
        });
    </script>
</body>
</html>
